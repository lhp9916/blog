---
title: PHP 标准规范
date: 2017-01-23 11:51:21
tags:
categories: 技术分享
---
PSR 是 PHP Standard Recommendations 的简写，由 PHP FIG 组织制定的 PHP 规范，是 PHP 开发的实践标准。

PHP FIG，FIG 是 Framework Interoperability Group（框架可互用性小组）的缩写，由几位开源框架的开发者成立于 2009 年，从那开始也选取了很多其他成员进来（包括但不限于 Laravel, Joomla, Drupal, Composer, Phalcon, Slim, Symfony, Zend Framework 等），虽然不是「官方」组织，但也代表了大部分的 PHP 社区。项目的目的在于：通过框架作者或者框架的代表之间讨论，以最低程度的限制，制定一个协作标准，各个框架遵循统一的编码规范，避免各家自行发展的风格阻碍了 PHP 的发展，解决这个程序设计师由来已久的困扰。

目前已表决通过了 6 套标准，已经得到大部分 PHP 框架的支持和认可。
![](/images/20170123/pass_psr.jpg)

### PSR 1 基本代码规范
- PHP代码文件必须以 <?php 或 <?= 标签开始；
- PHP代码文件必须以 不带BOM的 UTF-8 编码；
- PHP代码中应该只定义类、函数、常量等声明，或其他会产生 从属效应 的操作（如：生成文件输出以及修改.ini配置文件等），二者只能选其一；
- 命名空间以及类必须符合 PSR 的自动加载规范：PSR-4；
- 类的命名必须遵循 StudlyCaps 大写开头的驼峰命名规范；
- 类中的常量所有字母都必须大写，单词间用下划线分隔；
- 方法名称必须符合 camelCase 式的小写开头驼峰命名规范。

### PSR 2 代码风格规范
- 代码必须遵循 PSR-1 中的编码规范 。
- 代码必须使用4个空格符而不是 tab键 进行缩进。
- 每行的字符数应该软性保持在80个之内， 理论上一定不可多于120个， 但一定不能有硬性限制。
- 每个 namespace 命名空间声明语句和 use 声明语句块后面，必须插入一个空白行。
- 类的开始花括号({)必须写在其声明后自成一行，结束花括号(})也必须写在其主体后自成一行。
- 方法的开始花括号({)必须写在函数声明后自成一行，结束花括号(})也必须写在函数主体后自成一行。
- 类的属性和方法必须添加访问修饰符（private、protected 以及 public）， abstract 以及 final 必须声明在访问修饰符之前，而 static 必须声明在访问修饰符之后。
- 控制结构的关键字后必须要有一个空格符，而调用方法或函数时则一定不能有。
- 控制结构的开始花括号({)必须写在声明的同一行，而结束花括号(})必须写在主体后自成一行。
- 控制结构的开始左括号后和结束右括号前，都一定不能有空格符。

### PSR 3 日志接口规范
- LoggerInterface 接口对外定义了八个方法，分别用来记录 RFC 5424 中定义的八个等级的日志：debug、 info、 notice、 warning、 error、 critical、 alert 以及 emergency 。
- 第九个方法 —— log，其第一个参数为记录的等级。可使用一个预先定义的等级常量作为参数来调用此方法，必须与直接调用以上八个方法具有相同的效果。如果传入的等级常量参数没有预先定义，则必须抛出 Psr\Log\InvalidArgumentException 类型的异常。在不确定的情况下，使用者不该使用未支持的等级常量来调用此方法。

### PSR 4 自动加载规范
- 此处的“类”泛指所有的class类、接口、traits可复用代码块以及其它类似结构。

- 一个完整的类名需具有以下结构:

    \<命名空间>(\<子命名空间>)* \<类名>
    完整的类名必须要有一个顶级命名空间，被称为 "vendor namespace"；
    完整的类名可以有一个或多个子命名空间；
    完整的类名必须有一个最终的类名；
    完整的类名中任意一部分中的下划线都是没有特殊含义的；
    完整的类名可以由任意大小写字母组成；
    所有类名都必须是大小写敏感的。
    当根据完整的类名载入相应的文件……
    完整的类名中，去掉最前面的命名空间分隔符，前面连续的一个或多个命名空间和子命名空间，作为“命名空间前缀”，其必须与至少一个“文件基目录”相对应；
    紧接命名空间前缀后的子命名空间必须与相应的”文件基目录“相匹配，其中的命名空间分隔符将作为目录分隔符。
    末尾的类名必须与对应的以 .php 为后缀的文件同名。
    自动加载器（autoloader）的实现一定不能抛出异常、一定不能触发任一级别的错误信息以及不应该有返回值。

### PSR 6 缓存接口规范
缓存有如下几种方法，除了APC和OPcache是扩展，其他的都应该实现统一的缓存接口，如设置缓存、获取缓存、设置过期时间等。
- Database
- File
- Memcache
- Redis
- Array
- APC
- OPcache


### PSR 7 HTTP 消息接口规范
HTTP消息是Web开发的基础。Web浏览器和HTTP客户端之间，例如使用cURL创建一个发送到Web服务器的HTTP请求，Web服务器会返回一个HTTP响应。服务器端代码收到一个HTTP请求消息，并返回一个HTTP响应消息。

HTTP消息通常对与最终的消费者用户来说是抽象的，但作为开发者，我们通常需要知道它们是如何构建以及如何访问和操纵它们，以执行我们的任务，是否可能被创建为到HTTP API的请求或处理传入请求。

每一个HTTP请求消息有一个具体形式：

> POST /path HTTP/1.1
Host: example.com
foo=bar&baz=bat

一个请求的第一行是“请求行”，按照顺序包含了HTTP请求方法，请求的目标地址（通常是一个绝对URI或者服务器上的路径）以及HTTP协议的版本。接着是一个或多个HTTP头，一个空行，以及消息主体。

HTTP响应信息具有类似的结构：

>HTTP/1.1 200 OK
Content-Type: text/plain

第一行是“状态行”，按照顺序，依次包含了HTTP协议的版本，HTTP状态码，以及一个“原因分析”，也就是一个对人类友好可读的状态码的描述。像请求消息一样，随后一个或多个HTTP头，一个空行，以及消息主体。

更多详细文档请参考 [PHP编码规范](https://github.com/PizzaLiu/PHP-FIG)。
